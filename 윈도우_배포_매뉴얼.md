# 윈도우 프로그램 배포 매뉴얼

이 문서는 Rider Receipt Merger 프로그램을 Windows 실행 파일(.exe)로 배포하는 방법을 설명합니다.

## 사전 요구사항

### 1. Python 환경 설정
- Python 3.12 이상 설치 필요
- uv 패키지 매니저 설치 (권장)

### 2. 필요한 패키지 설치

프로젝트 루트 디렉토리에서 다음 명령어를 실행하세요:

```bash
# uv를 사용하는 경우
uv pip install -e .

# 또는 일반 pip를 사용하는 경우
pip install -e .
```

### 3. PyInstaller 설치

Windows 실행 파일을 생성하기 위해 PyInstaller를 설치합니다:

```bash
uv pip install pyinstaller
# 또는
pip install pyinstaller
```

## 배포 파일 생성

### 1. 기본 빌드 명령어

프로젝트 루트 디렉토리에서 다음 명령어를 실행합니다:

```bash
pyinstaller --name="RiderReceiptMerger" --windowed --onefile main.py
```

### 2. 권장 빌드 옵션 (상세 설정)

더 안정적인 배포를 위해 다음 옵션을 사용하는 것을 권장합니다:

```bash
pyinstaller ^
    --name="RiderReceiptMerger" ^
    --windowed ^
    --onefile ^
    --icon=NONE ^
    --add-data="config;config" ^
    --add-data="mapping_config.json;." ^
    --hidden-import=openpyxl ^
    --hidden-import=msoffcrypto ^
    --hidden-import=PySide6 ^
    --collect-all=openpyxl ^
    --collect-all=msoffcrypto ^
    main.py
```

### 3. 빌드 스크립트 사용 (권장)

프로젝트 루트에 `build.bat` 파일을 생성하여 사용할 수 있습니다:

**build.bat 파일 내용:**
```batch
@echo off
echo Rider Receipt Merger 빌드 시작...

pyinstaller --name="RiderReceiptMerger" --windowed --onefile --icon=NONE --add-data="config;config" --add-data="mapping_config.json;." --hidden-import=openpyxl --hidden-import=msoffcrypto --hidden-import=PySide6 --collect-all=openpyxl --collect-all=msoffcrypto main.py

if %ERRORLEVEL% EQU 0 (
    echo.
    echo 빌드 완료!
    echo 실행 파일 위치: dist\RiderReceiptMerger.exe
) else (
    echo.
    echo 빌드 실패!
    pause
)
```

**사용 방법:**
```bash
build.bat
```

## 빌드 결과물

빌드가 완료되면 다음 파일들이 생성됩니다:

- `dist/RiderReceiptMerger.exe` - 배포할 실행 파일
- `build/` - 빌드 중간 파일들 (삭제 가능)
- `RiderReceiptMerger.spec` - PyInstaller 설정 파일

## 배포 파일 준비

### 1. 필수 파일 복사

실행 파일과 함께 다음 파일들을 같은 폴더에 배포해야 합니다:

```
RiderReceiptMerger.exe
config/
  ├── settings.json
  └── settings.py
mapping_config.json
```

### 2. 배포 패키지 구조

최종 배포 폴더 구조:

```
RiderReceiptMerger/
├── RiderReceiptMerger.exe
├── config/
│   ├── settings.json
│   └── settings.py
└── mapping_config.json
```

## 테스트

### 1. 로컬 테스트

생성된 실행 파일을 로컬에서 테스트합니다:

```bash
dist\RiderReceiptMerger.exe
```

### 2. 테스트 항목

- [ ] 프로그램이 정상적으로 실행되는가?
- [ ] 파일 선택 기능이 작동하는가?
- [ ] 매핑 설정이 로드되는가?
- [ ] 병합 기능이 정상 작동하는가?
- [ ] 암호화된 Excel 파일을 읽을 수 있는가?

## 문제 해결

### 1. "ModuleNotFoundError" 오류

필요한 모듈이 포함되지 않은 경우, `--hidden-import` 옵션을 추가하세요:

```bash
pyinstaller --hidden-import=모듈명 ...
```

### 2. "FileNotFoundError" 오류

설정 파일이나 리소스 파일을 찾을 수 없는 경우, `--add-data` 옵션으로 포함시키세요:

```bash
pyinstaller --add-data="파일경로;대상경로" ...
```

### 3. 실행 파일 크기가 큰 경우

- `--onefile` 대신 `--onedir` 옵션 사용 (여러 파일로 분리)
- 불필요한 모듈 제외: `--exclude-module=모듈명`

### 4. 콘솔 창이 나타나는 경우

`--windowed` 옵션이 제대로 적용되지 않았을 수 있습니다. `--noconsole` 옵션도 함께 사용하세요:

```bash
pyinstaller --windowed --noconsole ...
```

## 고급 설정

### spec 파일 수정

더 세밀한 제어가 필요한 경우 `RiderReceiptMerger.spec` 파일을 직접 수정할 수 있습니다:

```python
# -*- mode: python ; coding: utf-8 -*-

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('config', 'config'),
        ('mapping_config.json', '.'),
    ],
    hiddenimports=[
        'openpyxl',
        'msoffcrypto',
        'PySide6',
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    noarchive=False,
)

pyz = PYZ(a.pure)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.datas,
    [],
    name='RiderReceiptMerger',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
)
```

수정 후 다시 빌드:

```bash
pyinstaller RiderReceiptMerger.spec
```

## 배포 체크리스트

배포 전 확인사항:

- [ ] 모든 의존성이 포함되었는가?
- [ ] 설정 파일이 올바른 위치에 있는가?
- [ ] 실행 파일이 다른 Windows PC에서도 작동하는가?
- [ ] 바이러스 백신 프로그램에서 오탐지되지 않는가?
- [ ] 사용자 매뉴얼이 준비되었는가?

## 참고사항

- PyInstaller는 실행 파일을 생성할 때 임시 폴더를 사용합니다. 첫 실행 시 약간의 지연이 발생할 수 있습니다.
- Windows Defender나 다른 백신 프로그램이 실행 파일을 차단할 수 있습니다. 이는 정상적인 현상이며, 신뢰할 수 있는 소스에서 배포하는 경우 문제없습니다.
- 실행 파일은 Python 런타임을 포함하므로 파일 크기가 큽니다 (보통 50-100MB).

## 추가 리소스

- [PyInstaller 공식 문서](https://pyinstaller.org/)
- [PySide6 배포 가이드](https://doc.qt.io/qtforpython/deployment.html)

